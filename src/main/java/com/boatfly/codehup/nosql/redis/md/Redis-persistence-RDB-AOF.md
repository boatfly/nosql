# Redis 持久化策略

## RDB（Redis DataBase）
`Snapshot快照`，恢复数据时直降快照文件读到内存里。
- Redis会单独创建（fork）一个子进程进行持久化，会先将数据写入一个临时文件，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。
  - fork的作用是复制一个与当前主进程一样的进程。新进程的所有数据（变量、环境变量、程序计数器等）都和原进程一致，作为原进程的子进程。
- 整个过程，主进程是不进行任何io操作的，这确保了极高的性能。
- 缺点：最后一次持久化后的数据可能丢失。
- 保存的是dump.rdb文件
  - 恢复时，只需将备份好的文件替换dump.rdb。
  
### 触发
- 配置约定
- save(阻塞进行)、bgsave(异步进行)
- flushdb、flushall

### 恢复
- 将备份文件copy到redis目录，并启动redis服务；
- config get dir （获取dump文件备份目录）

## 优势
- 适合大规模的数据恢复
- 对数据完整性和一致性要求不高（因为最后一次持久化后的数据可能丢失。）

## 劣势
- redis意外down掉，最后一次持久化之前的数据就会丢失。
- fork时，内存中的数据被复制了一份，大致2倍的膨胀性需要考虑。

## AOF（Append Only File）